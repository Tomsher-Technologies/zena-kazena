-- INSERT INTO `business_settings` (`id`, `type`, `value`, `lang`, `created_at`, `updated_at`) VALUES (NULL, 'home_center_banner', NULL, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- INSERT INTO `business_settings` (`id`, `type`, `value`, `lang`, `created_at`, `updated_at`) VALUES (NULL, 'home_mid_section_banner', NULL, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);


-- ALTER TABLE `page_translations` ADD `heading5` VARCHAR(255) NULL DEFAULT NULL AFTER `heading4`, ADD `heading6` VARCHAR(255) NULL DEFAULT NULL AFTER `heading5`, ADD `heading7` VARCHAR(255) NULL DEFAULT NULL AFTER `heading6`, ADD `heading8` VARCHAR(255) NULL DEFAULT NULL AFTER `heading7`, ADD `heading9` VARCHAR(255) NULL DEFAULT NULL AFTER `heading8`;


-- CREATE TABLE IF NOT EXISTS `home_sliders` (
--   `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
--   `name` varchar(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `image` int DEFAULT NULL,
--   `mobile_image` int DEFAULT NULL,
--   `title` varchar(191) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `sub_title` varchar(191) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `btn_text` varchar(191) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `link_type` varchar(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `link_ref` varchar(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `link_ref_id` int DEFAULT NULL,
--   `link` varchar(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
--   `sort_order` int DEFAULT '1',
--   `status` tinyint(1) NOT NULL DEFAULT '1',
--   `created_at` timestamp NULL DEFAULT NULL,
--   `updated_at` timestamp NULL DEFAULT NULL,
--   PRIMARY KEY (`id`)
-- ) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- CREATE TABLE IF NOT EXISTS `recently_viewed_products` (
--   `id` int NOT NULL AUTO_INCREMENT,
--   `user_id` int UNSIGNED DEFAULT NULL,
--   `guest_token` varchar(255) DEFAULT NULL,
--   `product_id` int NOT NULL,
--   `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
--   `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
--   PRIMARY KEY (`id`),
--   KEY `product_id` (`product_id`),
--   KEY `user_id` (`user_id`)
-- ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- ALTER TABLE `recently_viewed_products`
--   ADD CONSTRAINT `recently_viewed_products_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`) ON DELETE CASCADE,
--   ADD CONSTRAINT `recently_viewed_products_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE;


--   CREATE TABLE IF NOT EXISTS `carts` (
--   `id` int UNSIGNED NOT NULL AUTO_INCREMENT,
--   `user_id` int DEFAULT NULL,
--   `temp_user_id` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_unicode_ci DEFAULT NULL,
--   `product_id` int DEFAULT NULL,
--   `product_stock_id` int DEFAULT NULL,
--   `variation` text COLLATE utf8mb3_unicode_ci,
--   `quantity` int NOT NULL DEFAULT '0',
--   `price` double(20,2) DEFAULT '0.00',
--   `offer_price` double(20,2) DEFAULT NULL,
--   `offer_id` int DEFAULT NULL,
--   `offer_tag` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_unicode_ci DEFAULT NULL,
--   `tax` double(20,2) DEFAULT '0.00',
--   `shipping_cost` double(20,2) DEFAULT '0.00',
--   `shipping_type` varchar(30) CHARACTER SET utf8mb3 COLLATE utf8mb3_unicode_ci NOT NULL DEFAULT '',
--   `discount` double(10,2) NOT NULL DEFAULT '0.00',
--   `offer_discount` double(10,2) NOT NULL DEFAULT '0.00',
--   `coupon_code` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_unicode_ci DEFAULT NULL,
--   `coupon_applied` tinyint NOT NULL DEFAULT '0',
--   `status` tinyint(1) NOT NULL DEFAULT '0',
--   `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
--   `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
--   PRIMARY KEY (`id`),
--   KEY `product_id` (`product_id`),
--   KEY `product_stock_id` (`product_stock_id`)
-- ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_unicode_ci;

-- ALTER TABLE `carts`
--   ADD CONSTRAINT `carts_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`) ON DELETE CASCADE,
--   ADD CONSTRAINT `carts_ibfk_2` FOREIGN KEY (`product_stock_id`) REFERENCES `product_stocks` (`id`) ON DELETE CASCADE;

-- ALTER TABLE `wishlists` ADD `product_stock_id` INT NULL DEFAULT NULL AFTER `product_id`;

-- ALTER TABLE `wishlists` ADD FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE CASCADE ON UPDATE NO ACTION;
-- ALTER TABLE `wishlists` ADD FOREIGN KEY (`product_stock_id`) REFERENCES `product_stocks`(`id`) ON DELETE CASCADE ON UPDATE NO ACTION;

-- ALTER TABLE `orders` ADD `return_request` TINYINT(1) NULL DEFAULT '0' AFTER `cancel_reason`, ADD `return_request_date` INT NOT NULL AFTER `return_request`, ADD `return_approval` INT NOT NULL AFTER `return_request_date`, ADD `return_approval_date` INT NOT NULL AFTER `return_approval`, ADD `return_reason` INT NOT NULL AFTER `return_approval_date`;

-- ALTER TABLE `orders` CHANGE `return_request_date` `return_request_date` DATETIME NULL DEFAULT NULL, CHANGE `return_approval` `return_approval` TINYINT(1) NOT NULL DEFAULT '0' COMMENT '0 - Pending, 1 - Approved', CHANGE `return_approval_date` `return_approval_date` DATETIME NULL DEFAULT NULL, CHANGE `return_reason` `return_reason` TEXT NULL DEFAULT NULL;

-- CREATE TABLE IF NOT EXISTS `mortgages` (
--   `id` int NOT NULL AUTO_INCREMENT,
--   `name` varchar(255) DEFAULT NULL,
--   `email` varchar(255) DEFAULT NULL,
--   `phone` varchar(191) DEFAULT NULL,
--   `description` text,
--   `id_image` varchar(255) DEFAULT NULL,
--   `product_image` varchar(255) DEFAULT NULL,
--   `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
--   `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
--   PRIMARY KEY (`id`)
-- ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- ALTER TABLE `mortgages` ADD `duration` INT NULL AFTER `description`, ADD `metal` VARCHAR(50) NULL DEFAULT NULL AFTER `duration`, ADD `metal_type` VARCHAR(11) NULL DEFAULT NULL AFTER `metal`, ADD `weight` FLOAT NOT NULL DEFAULT '0' AFTER `metal_type`, ADD `eid_no` VARCHAR(191) NULL DEFAULT NULL AFTER `weight`, ADD `id_image_back` VARCHAR(255) NULL DEFAULT NULL AFTER `eid_no`;

-- INSERT INTO `pages` (`id`, `type`, `slug`, `image`, `status`, `created_at`, `updated_at`) VALUES (NULL, 'mortgage', 'Mortgage', NULL, '1', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP), (NULL, 'sales', 'Sales', NULL, '1', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- ALTER TABLE `page_translations` ADD `image2` VARCHAR(191) NULL DEFAULT NULL AFTER `image1`;

-- CREATE TABLE IF NOT EXISTS `sales` (
--   `id` int NOT NULL AUTO_INCREMENT,
--   `name` varchar(255) DEFAULT NULL,
--   `email` varchar(255) DEFAULT NULL,
--   `phone` varchar(191) DEFAULT NULL,
--   `description` text,
--   `metal` varchar(50) DEFAULT NULL,
--   `metal_type` varchar(11) DEFAULT NULL,
--   `weight` float NOT NULL DEFAULT '0',
--   `eid_no` varchar(191) DEFAULT NULL,
--   `id_image_back` varchar(255) CHARACTER SET utf8mb4  DEFAULT NULL,
--   `id_image` varchar(255) DEFAULT NULL,
--   `product_image` varchar(255) DEFAULT NULL,
--   `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
--   `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
--   PRIMARY KEY (`id`)
-- ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ;

-- ALTER TABLE `users` ADD `eid_no` VARCHAR(255) NULL DEFAULT NULL AFTER `email`, ADD `eid_image_front` VARCHAR(255) NULL DEFAULT NULL AFTER `eid_no`, ADD `eid_image_back` VARCHAR(255) NULL DEFAULT NULL AFTER `eid_image_front`;

-- ALTER TABLE `users` ADD `eid_approval_status` TINYINT(1) NOT NULL DEFAULT '0' COMMENT '0-Pending, 1-Approved, 2-Denied' AFTER `eid_no`;

ALTER TABLE `products` ADD `auction_start_date` INT NULL DEFAULT NULL AFTER `product_type`, ADD `auction_end_date` INT NULL DEFAULT NULL AFTER `auction_start_date`;

ALTER TABLE `product_stocks` ADD `high_bid_amount` DOUBLE(20,2) NOT NULL DEFAULT '0' AFTER `price`;

CREATE TABLE IF NOT EXISTS `bids` ( `id` int NOT NULL AUTO_INCREMENT, `product_id` int NOT NULL, `user_id` int NOT NULL, `amount` decimal(8,2) NOT NULL DEFAULT '0.00', `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE `bids` CHANGE `user_id` `user_id` INT(10) UNSIGNED NOT NULL;

ALTER TABLE `bids` ADD FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE CASCADE ON UPDATE NO ACTION;
ALTER TABLE `bids` ADD FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE `products` CHANGE `auction_start_date` `auction_start_date` DATETIME NULL DEFAULT NULL, CHANGE `auction_end_date` `auction_end_date` DATETIME NULL DEFAULT NULL;

ALTER TABLE `bids` ADD `winner` TINYINT(1) NOT NULL DEFAULT '0' AFTER `amount`;

ALTER TABLE `products` ADD `auction_status` TINYINT(1) NOT NULL DEFAULT '0' COMMENT '0-Not Completed, 1-Completed' AFTER `auction_end_date`, ADD `auction_winner` INT UNSIGNED NULL DEFAULT NULL AFTER `auction_status`;

ALTER TABLE `products` ADD FOREIGN KEY (`auction_winner`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE NO ACTION;

INSERT INTO `business_settings` (`id`, `type`, `value`, `lang`, `created_at`, `updated_at`) VALUES (NULL, 'auction_home_mid_banner', NULL, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO `business_settings` (`id`, `type`, `value`, `lang`, `created_at`, `updated_at`) VALUES (NULL, 'auction_home_center_banner', NULL, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO `business_settings` (`id`, `type`, `value`, `lang`, `created_at`, `updated_at`) VALUES (NULL, 'auction_home_mid_section_banner', NULL, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

ALTER TABLE `pages` ADD `video` VARCHAR(255) NULL DEFAULT NULL AFTER `image`;

ALTER TABLE `page_translations` ADD `title1` VARCHAR(255) NULL DEFAULT NULL AFTER `sub_title`, ADD `title2` VARCHAR(255) NULL DEFAULT NULL AFTER `title1`, ADD `title3` VARCHAR(255) NULL DEFAULT NULL AFTER `title2`;

ALTER TABLE `pages` ADD `image1` VARCHAR(255) NULL DEFAULT NULL AFTER `image`, ADD `image2` VARCHAR(255) NULL DEFAULT NULL AFTER `image1`, ADD `image3` VARCHAR(255) NULL DEFAULT NULL AFTER `image2`, ADD `image4` VARCHAR(255) NULL DEFAULT NULL AFTER `image3`;

ALTER TABLE `order_details` ADD `return_expiry_date` DATETIME NULL DEFAULT NULL AFTER `delivery_status`;

ALTER TABLE `vendors` CHANGE `profit_share` `profit_share` DECIMAL(5,2) NULL DEFAULT '0';

CREATE TABLE IF NOT EXISTS `commissions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `order_id` int NOT NULL,
  `product_id` int NOT NULL,
  `vendor_id` bigint UNSIGNED NOT NULL,
  `total_amount` double(20,2) NOT NULL DEFAULT '0.00',
  `admin_amount` double(20,2) NOT NULL DEFAULT '0.00',
  `vendor_amount` double(20,2) NOT NULL DEFAULT '0.00',
  `share_percentage` decimal(5,2) NOT NULL DEFAULT '0.00',
  `paid_status` tinyint(1) NOT NULL DEFAULT '0',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `order_id` (`order_id`),
  KEY `product_id` (`product_id`),
  KEY `vendor_id` (`vendor_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE `commissions`
  ADD CONSTRAINT `commissions_ibfk_1` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `commissions_ibfk_2` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `commissions_ibfk_3` FOREIGN KEY (`vendor_id`) REFERENCES `vendors` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT;

  ALTER TABLE `commissions` CHANGE `order_id` `order_id` INT NULL DEFAULT NULL;

  ALTER TABLE `commissions` ADD `order_type` VARCHAR(11) NULL DEFAULT 'sales' AFTER `id`;

  ALTER TABLE `rent_orders` ADD `variation` LONGTEXT NULL DEFAULT NULL AFTER `product_stock_id`;